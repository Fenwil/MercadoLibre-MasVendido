"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}chrome.runtime.sendMessage("getState",function(t){t&&sortItems()});var chunk=function(r,n){return Array.from({length:Math.ceil(r.length/n)},function(t,e){return r.slice(e*n,e*n+n)})},flatten=function(t){return t.reduce(function(t,e){return[].concat(_toConsumableArray(t),_toConsumableArray(e))},[])},getItemId=function(t){return(t.querySelector(".ui-search-item__group__element.ui-search-link").getAttribute("href").replace(/-/g,"").match(/MLA\d*/g)||[""])[0]};function sortItems(){var r=".ui-search-layout__item",o=[].concat(_toConsumableArray(document.querySelectorAll(r))),t=o.map(function(t){return getItemId(t)}).filter(function(t){return!t||"MLA"!==t}),t=chunk(t,20);Promise.all(t.map(function(t){return fetch("https://api.mercadolibre.com/items?ids="+t.join(",")+"&attributes=id,sold_quantity").then(function(t){return t.json()}).then(function(t){return t.map(function(t){return{id:t.body.hasOwnProperty("id")?t.body.id:0,soldQuantity:t.body.hasOwnProperty("sold_quantity")?t.body.sold_quantity:0}})})})).then(function(t){var n=flatten(t);o.forEach(function(t){var e=getItemId(t),r=(n.find(function(t){return t.id===e})||{soldQuantity:0}).soldQuantity;t.querySelector(".ui-search-item__group--price").innerHTML+='\n        <span class="sold_quantity" style="margin-top: 4px; font-size: 14px; font-weight: 600; padding: 0 6px; color: rgb(66, 90, 112); background-color: rgb(228, 231, 235); text-transform: uppercase">\n          '+(0<r?"+":"")+r+" vendidos\n        </span>\n      "});var t=[].concat(_toConsumableArray(document.querySelectorAll(r))).sort(function(t,e){return t.querySelector(".sold_quantity").innerText.replace(/\D/g,"")-e.querySelector(".sold_quantity").innerText.replace(/\D/g,"")}),e=document.querySelector(".ui-search-layout.ui-search-layout--stack");e.innerHTML=null,t.forEach(function(t){e.insertAdjacentElement("afterbegin",t)})})}